<!DOCTYPE html>
<!-- saved from url=(0032)http://jvns.ca/secret_blog_test/ -->
<html class=" js video" lang="en"><!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>Julia Evans</title>
	<meta name="author" content="Julia Evans">
	<meta name="description" content="Yesterday I wanted to start learning about how HDFS (the Hadoop
	Distributed File System) works internally. I knew that It&#8217;s distributed, so one &hellip;">

	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Julia Evans" type="application/atom+xml">
	<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
	<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
	<link href='http://fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Alegreya:400,900,700' rel='stylesheet' type='text/css'>
	<link href="main.css" rel="stylesheet" type="text/css">
</head>
<body data-twttr-rendered="true">
<header role="banner">
<hgroup>
<h1><a href="./simplified-frontpage_files/simplified-frontpage.html">Julia Evans</a></h1>
</hgroup>
<style>div#uliaea{font-size:12px;color:#aaa;text-align:right;}</style>
<ul class="header-navigation">
<li><a href="./simplified-frontpage_files/simplified-frontpage.html">Blog</a></li>
<li><a href="http://jvns.ca/secret_blog_test/about">About</a></li>
<li><a href="http://jvns.ca/secret_blog_test/talks">Talks</a></li>
<li><a href="http://jvns.ca/secret_blog_test/projects/">Projects</a></li>
<li><a href="twitter">Twitter</a></li>
<li><a href="github">Github</a></li>
</ul>
</header>
<nav role="navigation">

<ul class="main-navigation">
<li><a href="http://jvns.ca/secret_blog_test/blog/archives">Archives</a></li>
</ul>
<form action="http://google.com/search" method="get">
<fieldset role="search">
<input type="hidden" name="q" value="site:jvns.ca/secret_blog_test/">
<input class="search" type="text" name="q" results="0" placeholder="Search">
</fieldset>
</form>
<ul class="subscription" data-subscription="rss">
<li><a href="http://jvns.ca/secret_blog_test/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>
</nav>
<div id="main">
<div id="content">
<div class="blog-index">
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/06/06/working-remote/">Working remote, 3 months in</a></h1>
<p class="meta">
<time datetime="2014-06-06T19:59:14-07:00" pubdate="" data-updated="true">Jun 6<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>I’ve been working remotely for <a href="http://stripe.com/">Stripe</a> for 3
months now.</p>
<p>I decided to do this because I interviewed at this place, and the
people were thoughtful and friendly and interesting and knew things
that I did not know! But they were all in San Francisco, and I didn’t
want to move there at all. They convinced me that if I worked remote
it might not be a disaster.</p>
<p>I was still pretty scared about working remote, though! So far it’s
been hard, but I’m learning how to do it better. I’m somewhat
extroverted, so it’s possible for me to go a bit stir-crazy sitting
alone by myself all day.</p>
<p>I live on the east coast. The people I work with are mostly in San
Francisco, three timezones away. So when I start work it’s usually
around 6am in SF.</p>
<p>Let’s start with some things I have trouble with:</p>
<h3>Hard things</h3>
<ul>
<li>Timezones are hard. If I start working at 8, there aren’t many
people I can talk to BECAUSE IT’S 5AM. (however: it’s a really good
time to focus! And I can be a wizard and finish tasks before
everyone wakes up in the morning!)</li>
<li>I don’t know how to meet new people without visiting the physical
office. A lot of people are just names on IRC to me. I do not know
of any upside to this, or how to fix it.</li>
<li>I’m worried about the winter.</li>
<li>I didn’t realize how much I depended on synchronous communication
(talking face-to-face!) to do things until it was taken away from
me. This is thankfully getting easier.</li>
<li>It seems pretty difficult for me to know very much about the office
culture.</li>
<li>I find building consensus about technical decisions hard to do
remotely. (see: depending on synchronous communication)</li>
<li>A/V is hard. I often don’t try to participate in talks because I
don’t expect the experience to be good.</li>
</ul>
<h3>Good things:</h3>
<ul>
<li>I get to work with people who I like and live where I want to live.
And I’m learning a lot. This is why I decided to do this in the
first place =)</li>
<li>I can work in my backyard in the sun.</li>
<li>I have more flexibility about when and where to work. I appreciate
this more than I thought I would.</li>
<li>Thinking about working remote as “a cool possibility with some ups
and downs” instead of “this enemy that means I HAVE TO SEE LESS
PEOPLE OH NO” helps me be happy instead of grumpy.</li>
<li>My happiness seems to be proportional to the amount of time I spend
talking to people. This is something I can measure and optimize!</li>
<li>I’m getting better at asynchronous communication.</li>
<li>If I ask someone to do something when I finish work, they’ll be
working for 3 hours after me! It might be already done when I start
the next day.</li>
<li>2 people on my team are remote!
(<a href="https://twitter.com/colinmarc">colin</a> and
<a href="https://twitter.com/avibryant">avi</a>). This is a huge deal. If I
were the only one it would probably be a disaster and I would be way
more sad. As far as I can tell Avi’s been working remote
approximately forever and he has a lot of good things to say.</li>
<li>I like that Stripe actually changes things to accommodate remotes
(for instance: the all-hands meeting switched times so that it’s not
at 7:30pm on Friday on the east coast)</li>
<li>Basically all of the discussion on my team happens over IRC/email.
This means that there is a lot of IRC to keep up with. This is
harder than I expected.</li>
</ul>
<h3>Strategies</h3>
<ul>
<li>I changed my work computer’s clock to be the time in San Francisco.
This helps more than I expected.</li>
<li>I made a short URL (http://go/julia) that links to a Google Hangout
with me</li>
<li>Deciding to be happy this summer. There is no reason to be sad in
the summer.</li>
<li>Talking to other people who work remote sometimes and learning about
things they do!</li>
</ul>
<p>That’s all! Maybe there will be further updates.</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/06/06/should-my-conference-do-anonymous-review/">Should my conference do anonymous review?</a></h1>
<p class="meta">
<time datetime="2014-06-06T19:04:25-07:00" pubdate="" data-updated="true">Jun 6<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>I recently wrote an post called
<a href="http://jvns.ca/blog/2014/05/28/anonymous-talk-submission-equals-amazing/">Anonymous review is amazing</a>,
talking about our experience with anonymous review at
<a href="http://bangbangcon.com/">!!Con</a> (it was excellent! I was surprised
and delighted!). There was a discussion on the PyCon organizers list
today about whether PyCon should do anonymous review, and I started
thinking about this a little more carefully.</p>
<p>I’m going to make a few assumptions up front: our goal as conference
organizers is to have</p>
<ul>
<li>a process that is as unbiased as possible</li>
<li>speakers who will be engaging</li>
<li>who come from diverse backgrounds</li>
<li>where some are new speakers, and some are more experienced</li>
</ul>
<p>Let’s talk about whether anonymous review will help us with these things!</p>
<h2>Is anonymous review less biased?</h2>
<p><strong>Yes.</strong></p>
<p>Firstly, people <em>believe</em> that anonymous review is less biased.</p>
<p>One of our !!Con’s speakers,
<a href="https://twitter.com/hypotext">Katherine Ye</a>, told us:</p>
<blockquote><p>Thank you so much for [anonymizing everything]! It’s a relief to
know that I wasn’t picked for gender, race, age, or anything like
that.</p></blockquote>
<p><a href="https://twitter.com/hoxworth">Kenneth Hoxworth</a> said of RailsConf’s
anonymous review process:</p>
<blockquote><p>It gave me courage that I wasn’t going up against big names.</p></blockquote>
<p>It’s really important for people to have confidence in a conference’s
review process. Nobody wants to put time into a proposal if they’re
going to be dismissed because of their gender or age or race, or just
because they’re not famous enough. People also worry about not being
accepted on their own merit.</p>
<p>Anonymous review helps us build confidence, and that’s really
valuable.</p>
<p>Anonymous review is also <strong>actually</strong> less biased.
<a href="http://www.cs.utexas.edu/users/mckinley/notes/blind.html">This study by Kathryn McKinley</a>
shows that, in peer-reviewed scientific articles, both men and women
express systemic bias against women, and double-blind reviewing
removed that bias. (thanks to
<a href="https://twitter.com/lindsey">Lindsey Kuper</a> for the link!)</p>
<blockquote><p>They found nepotism and gender bias were signiﬁcant factors in the
evaluation process. To be judged as good as their male counter
parts, female applicants had to be 2.5 times more productive.</p></blockquote>
<h2>Will anonymous review help my conference’s diversity?</h2>
<p><strong>Maybe.</strong> <a href="https://ep2014.europython.eu/">EuroPython</a> has an anonymous
review process, and recently very few of their announced speakers
were women. This is because very few women applied to give talks.
You can’t accept talks that don’t exist!</p>
<p>A more effective way to diversify your speaker pool is through active
outreach. I don’t know of any evidence to show that anonymous review
helps you attract a more diverse range of speakers. (is there some? I
would love to know.)</p>
<h2>Will anonymous review help me get inexperienced speakers?</h2>
<p><strong>Maybe</strong>.</p>
<p>On one hand, we have</p>
<blockquote><p>It gave me courage that I wasn’t going up against big names.</p></blockquote>
<p>On the other hand, <a href="http://twitter.com/dougnap">Douglas Napoleone</a>
pointed out:</p>
<blockquote><p> An anonymous system has an inherent bias towards very well written
proposals. Those people whom have given the most talks are those
whom are best at writing proposals which are best at getting
through selection committees. It becomes a feedback loop which cuts
out the very speakers we want most. Knowing that a person is a new
speaker with a decent proposal is key when comparing them against a
proposal by someone whom has given a talk at the last 8 python
conferences.</p></blockquote>
<p>PyCon’s approach is to actively encourage new speakers to apply and
work with them to write better proposals, and that’s been successful.</p>
<p><a href="https://github.com/skade">Florian Gilchner</a> wrote about eurucamp’s
experience with anonymous review
<a href="https://gist.github.com/jvns/cf74079ecdded0dad502#comment-1240653">here</a>:</p>
<blockquote><p>We found that newcomers don’t write worse proposals than seasoned
speakers. Quite the contrary, we found that many proposals that are
submitted to many conferences are unspecific and dull and would only
fly by having a big name attached. Anonymous CFPs are very good at
weeding out copy-pasta. We didn’t accept quite a few people that
would have been really shiny on the program.</p></blockquote>
<p>and</p>
<blockquote><p>Every year, we have at least one person we take huge bets on and get
very good talks out of that. Most of the time, it’s someone would
[would lose out] in a direct and open battle.</p></blockquote>
<h2>But will my speakers be good?!</h2>
<p>This is probably the scariest part. We did anonymous review for !!Con,
and
<a href="http://jvns.ca/blog/2014/05/28/anonymous-talk-submission-equals-amazing/">our speakers were very good</a>.
Our main hope was that if somebody wrote a proposal about an
interesting topic, then they could give an engaging 10-minute talk.
This worked. It’s relevant here that our talks were all lightning
talks.</p>
<p>We also had an anonymizer, who did an amazing job reviewing videos and
telling us his impressions. This meant that we had to trust his
judgement (which I do! and our speakers were great!), but having only
one person watching talks introduces bias.</p>
<p>I’d be worried about doing anonymous review if I was organizing a
conference where the talks were longer. (though it’s been done
successfully!)</p>
<h2>So should you do anonymous review?</h2>
<p>Anonymous review takes extra time. You should think about what
benefits you hope that it’ll bring, and what your alternatives are.
There’s some excellent discussion on the comments to
<a href="https://gist.github.com/jvns/cf74079ecdded0dad502">a draft of this post</a>.
Go read the whole thing.</p>
<p>Some other things you can spend time on:</p>
<ul>
<li>doing outreach to get more applications from under-represented
communities</li>
<li>giving new speakers feedback on their proposals and helping them do
a better job</li>
<li>writing up a really good call for speakers (see
<a href="http://2014.jsconf.eu/call-for-speakers/">JSConf EU’s!</a>)</li>
<li>running brainstorming sessions to help people come up with ideas</li>
</ul>
<p>I would do it again for !!Con, since the response to it was super
positive and the talks were good. I find the bias-reduction argument
pretty compelling. Nepotism and accepting your friends’ talks are
really hard to fight against. Judging speaker quality still worries
me!</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/05/28/anonymous-talk-submission-equals-amazing/">Anonymous talk review is amazing.</a></h1>
<p class="meta">
<time datetime="2014-05-28T18:17:33-07:00" pubdate="" data-updated="true">May 28<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>Coming down from <a href="http://bangbangcon/">!!Con</a>, there are a lot of
things I want to talk about. One of the things that surprised and
delighted me the most was how well anonymous talk review worked. I
would like to tell you about this and how we structured our talk
review generally.</p>
<p>We decided to review all the talks anonymously, to try to reduce our
bias. This was a <em>ton</em> of work.
<a href="http://www.nullspace.io/">Alex Clemmer</a> personally anonymized all the
talk proposals and then sat out of the review process because he knew
the identities of the proposers. He did an amazing job (including
watching attached videos and summarizing them for the reviewers!).</p>
<p>I was honestly a bit scared by this – how were we going to make sure
people were good at public speaking if we didn’t even know who they
<em>were</em>?! But it turned out my fears were totally unfounded. We ended
up with</p>
<ul>
<li>a diverse range of talks (about art! compilers! type theory! assembly! games!)</li>
<li>by a good mix of experienced and new speakers</li>
<li>which were very well presented. The quality was even higher than I
expected, and I’d worked on reviewing the proposals!</li>
</ul>
<p>Several people told us that they liked the anonymous review because
they were confident they’d be judged fairly on the merits of their
proposal.</p>
<p>One of our accepted speakers,
<a href="https://twitter.com/hypotext">Katherine Ye</a>, told us:</p>
<blockquote><p>Thank you so much for [anonymizing everything]! It’s a relief to
know that I wasn’t picked for gender, race, age, or anything like
that.</p></blockquote>
<p>I would happily do anonymous review again. It was great.</p>
<h3>Outreach to women.</h3>
<p>This is going to be a whole separate post, since we worked really hard
on this. Basically: about 30-40% of our talk submissions were from
women, and 40% of the talks we accepted were by women. We didn’t
measure other axes of diversity (like race/class/other things).
There’s a lot of room for improvement.</p>
<h3>168 proposals!!!</h3>
<p>We were blown away by how many people submitted talks. And we only had
space for 24 talks! We had to make super hard decisions, and we didn’t
have much time.</p>
<h3>Talk review: Letter grades</h3>
<p><a href="https://twitter.com/lindsey">Lindsey</a> suggested
<a href="http://scg.unibe.ch/download/champion/#PATTERN5">this way of managing review</a>
after having seen it at academic conferences. Each of us assigned a
proposal a letter grade (A-D), from “I will fight for this talk”, to
“I will fight for this talk to be <em>rejected</em>”. We then looked at the
highest &amp; lowest grade for each talk and binned them into AA, AB, AC,
AD, BB, BC, BD, CC, CD, DD. We rejected any talk that didn’t have an
A.</p>
<p>If I knew who a proposal was by, I abstained from reviewing it (so
hard!).</p>
<p>This left us with maybe 80 talks that at least one person thought was
excellent-sounding. Still too many!</p>
<h3>GitHub issues for discusion</h3>
<p>We then used GitHub to discuss talk proposals. We put each talk into
an GitHub issue, and tagged them. Here are the tags we used.</p>
<ul>
<li><code>AA</code> - <code>AD</code> Letter grade ranking</li>
<li><code>accept</code> - Accepted</li>
<li><code>reject</code> - Rejected</li>
<li><code>has-advocate</code> - Someone has advocated this talk in the comments</li>
<li><code>reject-advocate</code> - Someone has argued for rejecting this talk in
the comments</li>
<li>a category: (work/fun/science/product/art/proglang/other)</li>
</ul>
<p>To be accepted, a talk needed an <em>advocate</em> – someone who would argue
for it to be accepted. Once it had an advocate, we would discuss its
merits in a video chat and decide whether to accept or reject it.</p>
<p>We did that, and after much sadness (what do you mean this is still
too many talks! We can’t accept three talks about the Curry-Howard
isomorphism!), we had a program!.</p>
<h3>Super-personal responses</h3>
<p>Alex, our Chief Anonymizer, did not only do an amazing job of
anonymizing! Not at all. We got a ton of submissions that we would
have <em>loved</em> to accept if we’d had more space.</p>
<p>So Alex sent personal emails to people whose talks we rejected saying
how interesting he thought their talks were and which parts
specifically he liked.</p>
<p>If your talk got rejected, you should consider submitting it to
another conference! We probably loved it.</p>
<h3>Amazing results</h3>
<p>My favorite things about anonymous talk review were</p>
<ul>
<li>it gave the speakers more confidence that they’d be judged fairly</li>
<li>it was impossible to accept less-interesting-sounding talks just
because they were “by someone famous”. There were amazing talks by
people who had never spoken at a conference before.</li>
<li>it was impossible to give preferential treatment to our friends!
This was a bit sad (some of my friends submitted talks that I knew
were great, and were rejected, and I couldn’t do anything), but it
made the conference better.</li>
</ul>
<p>Here’s the <a href="http://bangbangcon.com/program.html">final program</a>. There
was weaving! Assembly! How serial protocols work! Logic programming!
Hacking poetry! Robots dancing! Python’s 1500-line switch statement!
All of the speakers did an amazing job – I think for every single
talk I heard someone say “Wow, that was my favorite talk!”</p>
<p>None of this is to say that anonymous review is the best way to do
talk review. PyCon does not do anonymous review at all, and I think
they do a great job. But it worked very well for us.</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/05/15/diving-into-hdfs/">Diving into HDFS</a></h1>
<p class="meta">
<time datetime="2014-05-15T09:40:39-07:00" pubdate="" data-updated="true">May 15<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>Yesterday I wanted to start learning about how HDFS (the Hadoop
Distributed File System) works internally. I knew that</p>
<ul>
<li>It’s distributed, so one file may be stored across many different
machines</li>
<li>There’s a <em>namenode</em>, which keeps track of where all the files are
stored</li>
<li>There are <em>data nodes</em>, which contain the actual file data</li>
</ul>
<p>But I wasn’t quite sure how to get started! I knew how to navigate the
filesystem from the command line (<code>hadoop fs -ls /</code>, and friends), but
not how to figure out how it works internally.</p>
<p><a href="http://twitter.com/colinmarc">Colin Marc</a> pointed me to this great
library called <a href="https://github.com/spotify/snakebite">snakebite</a> which
is a Python HDFS client. In particular he pointed me to the part of
the code that
<a href="https://github.com/spotify/snakebite/blob/master/snakebite/client.py#L966-L1033">reads file contents from HDFS</a>.
We’re going to tear it apart a bit and see what exactly it does!</p>
<h3>Getting started: Elastic MapReduce!</h3>
<p>I didn’t want to set up a Hadoop cluster by hand, and I had some AWS
credit that I’d gotten for free, so I set up a small Amazon Elastic
MapReduce cluster. I worked on this with with
<a href="https://twitter.com/ptn777">Pablo Torres</a> and
<a href="https://twitter.com/SashaLaundy">Sasha Laundy</a> and we spent much of
the morning fighting with it and trying to figure out protocol
versions and why it wasn’t working with Snakebite.</p>
<p>What ended up working was choosing AMI version “3.0.4 (hadoop 2.2.0)”.
This is CDH5 and Hadoop protocol version 9. Hadooop versions are
<em>confusing</em>. We installed that and Snakebite version 2.4.1 and that
almost worked.</p>
<p><strong>Important things</strong>:</p>
<ul>
<li>We needed to look at <code>/home/hadoop/conf/core-site.xml</code> to find the
namenode IP and port (in <code>fs.default.name</code></li>
<li>We needed to edit
<a href="https://github.com/spotify/snakebite/blob/25418007e93f99f6dc6807ca44d25287217e783f/snakebite/config.py">snakebite/config.py</a>
to say ‘fs.default.name’ instead of ‘fs.defaultFS’. Who knows. It
worked.</li>
</ul>
<p>Once we did this, we could run <code>snakebite ls /</code> successfully! Time to
move on to breaking things!</p>
<h3>Putting data into our cluster</h3>
<p>I copied some Wikipedia data from one of Amazon’s public datasets like
this;</p>
<p><code>hadoop distcp
s3://datasets.elasticmapreduce/wikipediaxml/part-116.xml /wikipedia</code></p>
<p>This creates a file in HDFS called <code>/wikipedia</code>. You can see more
datasets that are easy to copy into HDFS from Amazon at
<a href="https://s3.amazonaws.com/datasets.elasticmapreduce/">https://s3.amazonaws.com/datasets.elasticmapreduce/</a>.</p>
<h3>Getting a block from our file!</h3>
<p>Now that we have a Hadoop cluster, some data in HDFS, and a tool to
look at it with (snakebite), we can really get started!</p>
<p>Files in HDFS are split into <em>blocks</em>. When getting a file from HDFS,
the first thing we need to do is to ask the namenode where the blocks
are stored.</p>
<p>With the help of a lot of snakebite source diving, I write a small
Python function to do this called <code>find_blocks</code>. You can see it in a
tiny Python module I made called
<a href="https://github.com/jvns/hadoop_fun/blob/master/hdfs_fun.py">hdfs_fun.py</a>.
To get it to work, you’ll need a Hadoop cluster and snakebite.</p>
<pre>&gt;&gt;&gt; cl = hdfs_fun.create_client()
&gt;&gt;&gt; hdfs_fun.find_blocks(cl, '/wikipedia')
[snakebite.protobuf.hdfs_pb2.LocatedBlockProto at 0xe33a910,
 snakebite.protobuf.hdfs_pb2.LocatedBlockProto at 0xe33ab40
</pre>
<p>One of the first things I did was use <code>strace</code> to find out what data actually gets sent over the wire when I call this function. Here’s a snippet: (<a href="https://gist.github.com/jvns/bc054ea0f38b5054fd3a">the whole thing</a>)</p>
<p>Part of the request: asking for the block locations for the
<code>/wikipedia</code> file.</p>
<pre>sendto(7,
"\n\21getBlockLocations\22.org.apache.hadoop.hdfs.protocol.ClientProtocol\30\1",
69, 0, NULL, 0) = 69
sendto(7, "\n\n/wikipedia\20\0\30\337\260\240]", 19, 0, NULL, 0) = 19
</pre>
<p>Part of the response: (I’ve removed most of it to point out some of
the important parts)</p>
<pre>recvfrom(7,
"....BP-1019336183-10.165.43.39-1400088409498..........................
10.147.177.170-9200-1400088495802........................
BP-1019336183-10.165.43.39-1400088409498.............10.147.177.170-9200-1400088495802
\360G(\216G0\361G8\0\20\200\240\201\213\275\f\30\200\340\376]
\200\300\202\255\274\f(\200\340\376]0\212\306\273\205\340(8\1B\r/default-rackP\0
\0*\10\n\0\22\0\32\0\"\0\30\0\"\355", 731, 0, NULL, NULL) = 731
</pre>
<p>Back in our Python console, we can see what some of these numbers mean:</p>
<pre>&gt;&gt;&gt; blocks[0].b.poolId
u'BP-1019336183-10.165.43.39-1400088409498'
&gt;&gt;&gt; blocks[0].b.numBytes
134217728L
&gt;&gt;&gt; blocks[0].locs[0].id.ipAddr
u'10.147.177.170'
&gt;&gt;&gt; blocks[0].locs[0].id.xferPort
9200
&gt;&gt;&gt; blocks[1].b.poolId
u'BP-1019336183-10.165.43.39-1400088409498'
&gt;&gt;&gt; blocks[1].b.numBytes
61347935L
</pre>
<p>So we have two blocks! The two <code>numBytes</code> add up to the total size of
the file! Cool! They both have the same <code>poolId</code>, and it also turns
out that they have the same IP address and port</p>
<h3>Reading a block</h3>
<p>Let’s try to read the data from a block! (you can see the <code>read_block</code>
function here in
<a href="https://github.com/jvns/hadoop_fun/blob/master/hdfs_fun.py">hdfs_fun.py</a></p>
<pre>&gt;&gt;&gt; block = blocks[0]
&gt;&gt;&gt; gen = hdfs_fun.read_block(block) # returns a generator
&gt;&gt;&gt; load = gen.next()
</pre>
<p>If I look at <code>strace</code>, it starts with:</p>
<pre>connect(8, {sa_family=AF_INET, sin_port=htons(9200),
    sin_addr=inet_addr("10.147.177.170")}, 16) = 0
sendto(8,
    "\nB\n5\n3\n(BP-1019336183-10.165.43.39-1400088409498\20\211\200\200\200\4\30\361\7\22\tsnakebite\20\0\30\200\200\200@",
    75, 0, NULL, 0) = 75
</pre>
<p><em>Awesome</em>. We can see easily that it’s connecting to the block’s data
node (<code>10.147.177.170</code> on port <code>9200</code>, and asking for something with
id <code>BP-1019336183-10.165.43.39-1400088409498</code>). Then the data node
starts sending back data!!!</p>
<pre>recvfrom(8, "ot, it's a painting. Thomas Graeme apparently lived in
the mid-18th century, according to the [[Graeme Park]] article. The
rationale also says that this image is "used on the biography
page about him by USHistory.org of Graeme Park." I cannot quite
figure out what this means, but I am guessing that it means the
uploader took this image from a page hosted on USHistory.org. A
painting of a man who lived in the mid-18th century is likely to be
the public domain, as claimed, but we have no good source", 512, 0,
NULL, NULL) = 512
</pre>
<p>AMAZING. We have conquered HDFS.</p>
<p>That’s all for this blog post! We’ll see if I do more later today.</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/05/13/profiling-with-perf/">I can spy on my CPU cycles with perf!</a></h1>
<p class="meta">
<time datetime="2014-05-13T17:47:49-07:00" pubdate="" data-updated="true">May 13<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>Yesterday I talked about using <code>perf</code> to profile assembly
instructions. Today I learned how to make flame graphs with <code>perf</code>
today and it is THE BEST. I found this because
<a href="https://twitter.com/graydon_moz">Graydon Hoare</a> pointed me to Brendan
Gregg’s <em>excellent</em>
<a href="http://www.brendangregg.com/perf.html">page on how to use perf</a>.</p>
<p>Wait up! What’s <code>perf</code>? I’ve talked about <code>strace</code> a lot before (in
<a href="http://jvns.ca/blog/2014/04/20/debug-your-programs-like-theyre-closed-source/">Debug your programs like they’re closed source</a>).
<code>strace</code> lets you see which system calls a program is calling. But
what if you wanted to know</p>
<ul>
<li>how many CPU instructions it ran?</li>
<li>How many L1 cache misses there were?</li>
<li>profiling information for each assembly instruction?</li>
</ul>
<p><code>strace</code> only does system calls, and none of those things are system
calls. So it can’t tell you any of those things!</p>
<p><code>perf</code> is a Linux tool that can tell you all of these things, and
more! Let’s run a quick example on the
<a href="http://jvns.ca/blog/2014/05/12/computers-are-fast/">bytesum program from yesterday</a>.</p>
<pre>bork@kiwi ~/w/howcomputer&gt; perf stat ./bytesum_mmap *.mp4
 Performance counter stats for './bytesum_mmap The Newsroom S01E04.mp4':

        158.141639 task-clock                #    0.994 CPUs utilized          
                22 context-switches          #    0.139 K/sec                  
                 9 CPU-migrations            #    0.057 K/sec                  
               133 page-faults               #    0.841 K/sec                  
       438,662,273 cycles                    #    2.774 GHz                     [82.43%]
       269,916,782 stalled-cycles-frontend   #   61.53% frontend cycles idle    [82.38%]
       131,557,379 stalled-cycles-backend    #   29.99% backend  cycles idle    [66.66%]
       681,518,403 instructions              #    1.55  insns per cycle        
                                             #    0.40  stalled cycles per insn [84.88%]
       130,568,804 branches                  #  825.645 M/sec                   [84.85%]
            20,756 branch-misses             #    0.02% of all branches         [83.68%]

       0.159154389 seconds time elapsed
</pre>
<p>This is super neat information, and there’s a lot more (see <code>perf
list</code>). But we can do even more fun things!</p>
<h3>Flame graphs with perf</h3>
<p>I wanted to profile my <code>bytesum</code> program. But how do you even profile
C programs? Here’s a way to do it with <code>perf</code>:</p>
<pre>sudo perf record -g ./bytesum_mmap *.mp4
sudo perf script | stackcollapse-perf.pl | flamegraph.pl &gt; flamegraph.svg
</pre>
<p>Here’s the SVG this gave me:</p>
<p><img src="./simplified-frontpage_files/flamegraph.svg"></p>
<p>This is AMAZING. But what does it mean? Basically <code>perf</code> periodically
interrupts the program and finds out where in the stack it is. The
width of each part of the stack in the graph above is the proportion
of samples that happened there. (so about 30% of the execution time
was spend in <code>main</code>). I don’t know what the colour means here.</p>
<p>We can see that there are 3 big parts – there’s the <code>mmap</code> call (on
the left), the main program execution (in the middle), and the
<code>sys_exit</code> part on the right. Apparently stopping my program takes a
long time! Neat!</p>
<p>But there’s more!</p>
<h3>Is it really L1 cache misses? We can find out!</h3>
<p>So yesterday I made a program with really bad memory access patterns
(<a href="https://github.com/jvns/howcomputer/blob/master/bytesum_stride.c">bytesum_stride.c</a>),
and I conjectured that it was way slower because it was causing way
too many L1 cache misses.</p>
<p>But with <code>perf</code>, we can check if that’s actually true! Here are the
results (reformatted a bit to be more compact):</p>
<pre>bork@kiwi ~/w/howcomputer&gt; perf stat -e L1-dcache-misses,L1-dcache-loads ./bytesum_mmap *.mp4
        17,175,214 L1-dcache-misses #   11.48% of all L1-dcache hits  
       149,568,438 L1-dcache-loads
bork@kiwi ~/w/howcomputer&gt; perf stat -e L1-dcache-misses,L1-dcache-loads ./bytesum_stride *.mp4 1000
     1,031,902,483 L1-dcache-misses #  193.16% of all L1-dcache hits  
       534,219,219 L1-dcache-loads
</pre>
<p>So, uh, that’s really bad. We now have <strong>60 times more</strong> L1 cache
misses, and also 3 times more hits.</p>
<h3>Other amazing things</h3>
<ul>
<li>Go to
<a href="http://www.brendangregg.com/perf.html">Brendan Gregg’s perf page and read the whole thing</a>.
Also possibly everything he’s ever written. His recent post on
<a href="http://www.brendangregg.com/blog/2014-05-11/strace-wow-much-syscall.html">strace</a>
is great too.</li>
<li>The <a href="https://perf.wiki.kernel.org/index.php/Tutorial">perf tutorial</a>
is pretty long, but I found it somewhat helpful.</li>
<li><a href="https://github.com/brendangregg/FlameGraph">FlameGraph!</a></li>
<li>I spent a little bit of time running cachegrind with
<code>valgrind --tool=cachegrind ./bytesum_mmap my_file</code>
which can give you possibly even more information about CPU caches
than <code>perf</code> can. Still haven’t totally wrapped my head around this.</li>
</ul>
<p>There are still so many things I don’t understand at all!</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/05/12/computers-are-fast/">Computers are *fast*!</a></h1>
<p class="meta">
<time datetime="2014-05-12T18:31:59-07:00" pubdate="" data-updated="true">May 12<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>So I have a computer. My computer contains hardware (like a CPU! RAM!
L1/L2 caches!) But I don’t understand very well how fast that hardware
is, what tools I have to profile it, and how much of the time that my
programs are running is split between RAM/the hard disk/the CPU.</p>
<p>So today I paired with
<a href="https://twitter.com/SashaLaundy">Sasha Laundy</a>, and we ran Serious
Investigations into how fast my computer can process a 1GB file.</p>
<p><strong>The objects:</strong></p>
<ul>
<li>An episode of The Newsroom (1GB)</li>
<li>A task: add up all the bytes (mod 256)</li>
</ul>
<p>This was basically the easiest task that I could think of that
involved processing the entire file (so nothing gets optimized out by
the compiler).</p>
<h3>Step 1: Write a program to add up all the bytes</h3>
<p>I wrote a small C program to add up all the bytes in a file. It’s
called
<a href="https://github.com/jvns/howcomputer/blob/master/bytesum.c">bytesum.c</a>.
It reads the file in chunks of 64k, and then adds up all the bytes
into a char.</p>
<p>This runs pretty fast! I compiled it with <code>gcc -Ofast</code> (to make it
FASTER!) and it added up all the bytes in</p>
<ul>
<li>2.5 seconds (the first time I ran the program)</li>
<li>0.6 seconds (the second time I ran the program, because it’s already
loaded into RAM)</li>
</ul>
<p>I take this to mean that it takes 2s to read the file into memory (I
have a SSD in my computer, so 500MB/s makes sense), and then 0.6s to
do the actual adding-up-of-the bytes. Awesome! We now know that I can
read from my hard drive at 500MB/s.</p>
<h3>Step 2: try to use <code>mmap</code> to make it faster</h3>
<p>This is a pretty boring step. We made it use <code>mmap</code> instead (see
<a href="https://github.com/jvns/howcomputer/blob/master/bytesum_mmap.c">bytesum_mmap.c</a>),
in the hopes that it would make it faster. It took exactly the same
amount of time. NEXT.</p>
<h3>Step 3: use vector intrinsics!!!</h3>
<p>Then I went and talked to <a href="http://jamesporter.me/">James Porter</a>, and
he told me that CPUs have special instructions for doing multiple
additions at once, and that I could maybe use them to optimize my
program! So I googled “vector intrinsics”, copied some code from Stack
Overflow, and ended up with a new version:
<a href="https://github.com/jvns/howcomputer/blob/master/bytesum_intrinsics.c">bytesum_intrinsics.c</a>.
I timed it, and it took <strong>0.25 seconds</strong>!!!</p>
<p>So our program now runs <strong>twice as fast</strong>, and we know a whole bunch
of new words (SSE! SIMD! vector intrinsics!)</p>
<h3>Step 4: Make it slow.</h3>
<p>Now that we’ve written a super fast program, I wanted to understand
the CPU caches better. What if we engineered a whole bunch of cache
misses? I wrote a new version of <code>bytesum_mmap.c</code> that added up all
the bytes in an irregular way – instead of going through all the
bytes in order, it would skip from byte 1 to 2001 to 3001 to 4001 and
then loop around and access 2, 2002, 3002, …, 100002. As you might
imagine, this isn’t very efficient.</p>
<p>You can see the code for this in
<a href="https://github.com/jvns/howcomputer/blob/master/bytesum_stride.c">bytesum_stride.c</a>.
I ran it with <code>./bytesum_stride *.mp4 60000</code>, and it took about 20
seconds. So we’ve learned that <strong>cache misses can make your code 40
times slower</strong>.</p>
<h3>Step 5: where do the 0.25 seconds come from???</h3>
<p>I still didn’t totally understand exactly how my super fast vector
intrinsic program’s performance broke down, though: how much of that
0.25 seconds was spent doing memory accesses, and how much in
numerical computation? James suggested using
<a href="http://marss86.org/~marss86/index.php/Home">Marss</a> which will
apparently give you unlimited amounts of information, but I spent a
few minutes trying to get it to work and failed.</p>
<p>So instead I used <code>perf</code>, which is a <em>totally magical</em> performance
measurement tool for Linux. I needed to upgrade my kernel first, which
was a bit nervewracking. But I did it! And it was beautiful. There are
colours, and we got it to annotate the assembly code with performance
statistics. Here’s what I ran to do it:</p>
<pre>perf record ./bytesum_intrinsics The\ Newsroom\ S01E04.mp4
perf annotate --no-source
</pre>
<p>And here’s the result:</p>
<p><img src="./simplified-frontpage_files/perf.png"></p>
<p>The <code>movdqa</code> instructions have to do with accessing memory, and it
spends 32% of its time on those instructions. So I <em>think</em> that means
that it spends 32% of its time accessing RAM, and the other 68% of its
time doing calculations. Super neat!</p>
<p>There are still a lot of things I don’t understand here – are my
conclusions about this program correct? Are there further things I
could be doing to optimize this?</p>
<p>I’m also kind of amazed by how fast C is. I’m used to writing in
dynamic programming languages, which definitely do not process 1GB
files in 0.25 seconds. Fun!</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/04/27/stopping-to-think/">Stopping to think</a></h1>
<p class="meta">
<time datetime="2014-04-27T08:40:50-07:00" pubdate="" data-updated="true">Apr 27<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>A while ago I had a bug in my code. I was frustrated because I
couldn’t get into a debugger to get more information – I needed to
know more to understand what was going on! I went home, sad.</p>
<p>On my way back in the morning, I thought about the error message I’d
seen. I realized I didn’t need more information! What I had was
enough, and I knew how to fix it. I’d like to remember to step back
and think more often and more quickly.</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/04/26/i-dont-feel-guilty-about-not-contributing-to-open-source/">Don’t feel guilty about not contributing to open source</a></h1>
<p class="meta">
<time datetime="2014-04-26T08:56:33-07:00" pubdate="" data-updated="true">Apr 26<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>For a long time I had a vague feeling that I <em>should</em> be contributing
to open source more, and that it was in some way a Good Thing. And I
felt a little bit guilty about not doing it enough.</p>
<p>I used to have this dialog with myself pretty often:</p>
<ul>
<li>Okay, Julia, open source is good!</li>
<li>Yeah, I should go do some open source</li>
<li>What project? I don’t know. huh.</li>
<li>I use <a href="https://www.pidgin.im/">Pidgin</a>! Maybe that</li>
<li><em>go look at pidgin</em></li>
<li>so many issues! I don’t even know where to start</li>
<li>and it’s in C! so many code! how do I even!</li>
<li>Give up, feel vaguely guilty</li>
</ul>
<p>I’m trying to stop feeling guilty. Now if I’m going to contribute to a
project, it needs to be something that I’m motivated to do.
<a href="http://blog.melchua.com/">Mel Chua</a> gave a great talk at Hacker
School where she said motivation is made up of <em>competence</em> (I know
how to do this!), <em>autonomy</em> (I can make my own decisions!), and
<em>relatedness</em> (I know why I’m doing this!).</p>
<p>In open source there’s pretty high autonomy – nobody’s ever going to
force you to work on anything. So what’s usually missing is
<em>relatedness</em> and <em>competence</em>.</p>
<p>For relatedness, I’ll ask myself:</p>
<p><strong>“What do I hope to get out of contributing to this project?</strong></p>
<ul>
<li>I want to know how it works! (contributing to Linux could be super
fun for this reason! Operating systems are amazing! My
<a href="https://github.com/jvns/gzip.jl">gunzip in julia</a> is a project
where I learned a ton.)</li>
<li>I found a bug and I want to fix it! I want to add a feature!</li>
<li>I want to build up a portfolio of programming work to get better
jobs!</li>
<li>I think this project is doing important work and I’d like to advance
it! (Kelsey Gilmore-Innis’s work on the
<a href="http://antievictionmappingproject.net/">Anti-Eviction Mapping Project</a>
is a great example)</li>
<li>I like spending time with the people who work on this project! (When
I went to Drupal conferences, all the Drupal devs were totally
lovely people and really made me want to contribute to Drupal)</li>
</ul>
<p>For competence, I’ll ask:</p>
<p><strong>Is there anything that will stop me from getting work done?</strong></p>
<ul>
<li>Do I know the language this is written in? Is it easy to learn?</li>
<li>Can I set up a dev environment easily on my computer?</li>
<li>How complex is the codebase? Is it approachable? Is the
documentation good?</li>
<li>If I don’t know something I need to know, will the community answer
my questions? Will they be jerks? Is the mailing list active?</li>
</ul>
<h2>why I don’t</h2>
<p>I usually don’t contribute to open source because of <em>relatedness</em> –
I don’t know what I’ll get out of it! A super great example of this is
Drupal. <a href="https://drupal.org/">Drupal</a> is a tremendously important
project. I’ve contributed to it before! I could do it again! The
community is extraordinarily welcoming! But it’s missing <em>relatedness</em>
for me right now – I’m not developing websites anymore.</p>
<p>Most open source projects fails relatedness – if I don’t use it,
don’t want to learn about it right now, don’t know anyone who works on
it, and/or don’t believe strongly in its mission, I probably don’t
want to contribute! This is TOTALLY OKAY. There are tons of people who
are contributing to those projects! They will be okay without me =)</p>
<p>A great example of a project that fails competence is Pidgin, above –
I might have had some issue with my chat client that I wanted to fix,
but the barrier to entry seemed too high at the time.</p>
<h2>why I do!</h2>
<p>Here are some open source-y projects I have worked on and why:</p>
<ul>
<li><a href="https://github.com/ipython/ipython">IPython</a>, because there was a
feature I wanted it to have that it didn’t! Now it does! One of my
PRs got merged into IPython and it is SUPER COOL.</li>
<li>A <a href="https://github.com/jvns/pandas-cookbook">pandas cookbook</a>,
because when I learned pandas there weren’t as many practical
materials as I wanted! Now there’s one more! People are learning
more about pandas because I wrote a thing! THE BEST.</li>
<li><a href="https://github.com/jvns/gzip.jl">gzip in julia</a>, to learn how gzip
worked. Now I know! AWESOME.</li>
</ul>
<p>Working on open source projects can be super fun! Yay!</p>
<h2>don’t feel guilty</h2>
<p>There are so many things you could be doing. If it takes 30 hours of
your time over 3 weeks to fix a network card issue, maybe that’s
worthwhile because you learned a lot and your hardware works better!
Or maybe you would rather spend that time with your family or friends
or volunteering or playing soccer or watching movies or working to pay
your rent.</p>
<p>I sometimes hear people say “you should write open source software!”
like it’s a universal good. Don’t. Do it if it makes sense for you! Do
it if you know what you’ll get out of it, and you feel that it’s worth
your time! If not, do other things instead!</p>
</div>
</article>
<article>
<header>
<h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/04/20/debug-your-programs-like-theyre-closed-source/">Debug your programs like they’re closed source!</a></h1>
<p class="meta">
<time datetime="2014-04-20T15:30:54-07:00" pubdate="" data-updated="true">Apr 20<span>th</span>, 2014</time>
</p>
</header>
<div class="entry-content"><p>Until very recently, if I was debugging a program, I practically
always did one of these three things:</p>
<ol>
<li>open a debugger</li>
<li>look at the source code</li>
<li>insert some print statements</li>
</ol>
<p>I’ve started sometimes debugging a new way. With this method, I don’t
look at the source code, don’t edit the source code, and don’t use a
debugger. I don’t even need to have the program’s source available to
me!</p>
<p>Can we repeat that again? I can look at the internal behavior of
<em>closed-source programs</em>.</p>
<p>How?!?! AM I A WIZARD? Nope. SYSTEM CALLS! What is a system call?
Operating systems know how to open files, display things to the
screen, start processes, and all kinds of things. Programs can ask
their operating system to do these things, using functions called
<strong>system calls</strong>.</p>
<p>System calls are the API for your computer, so you don’t have to know
how a network card works to send a HTTP request.</p>
<p>Here’s a list of the
<a href="http://docs.cs.up.ac.za/programming/asm/derick_tut/syscalls.html">system calls Linux 2.2</a>
provides, to give you a sense for what’s available. There’s <code>exit</code>,
<code>open</code>, <code>read</code>, <code>write</code>, <code>time</code>, <code>mount</code>, <code>kill</code>, and all kinds of
other things. System calls are basically the definition of platform
specific (different operating system have different system calls), so
we’re only going to be talking about Linux here.</p>
<p>How can we use these to debug? Here are a few of my favorite system
calls!</p>
<h2>open</h2>
<p><code>open</code> opens files. Every time any program opens a file it needs to
use the <code>open</code> system call. There’s no other way.</p>
<p>So! Let’s say you have a backup program on your computer, and you want
to know which files it’s working on. And that it doesn’t show you a
progress bar or have any options. Let’s say that it has PID 60.</p>
<p>We can spy on this program with a tool called <code>strace</code> and print out
every file it opens! <code>strace</code> shows you which system calls a program
calls. To spy on our backup program, we would run <code>strace -e trace=open
-p 60</code>, to tell it to print all the <code>open</code> system calls from PID 60.</p>
<p>For example, I ran <code>strace -e trace=open ssh</code> and here were some of the
things I found:</p>
<pre>open("/etc/ssh/ssh_config", O_RDONLY)   = 3
open("/home/bork/.ssh/config", O_RDONLY) = 3
open("/home/bork/.ssh/id_dsa", O_RDONLY) = 4
open("/home/bork/.ssh/id_dsa.pub", O_RDONLY) = 4
open("/home/bork/.ssh/id_rsa", O_RDONLY) = 4
open("/home/bork/.ssh/id_rsa.pub", O_RDONLY) = 4
open("/home/bork/.ssh/known_hosts", O_RDONLY) = 4
</pre>
<p>This makes total sense! <code>ssh</code> needs to read my private and public
keys, my local ssh config, and the global ssh config. Neat! <code>open</code> is
super simple and super useful.</p>
<h2>execve</h2>
<p><code>execve</code> starts programs. All programs. There’s no way to start a
program except to use <code>execve</code>. We can use <code>strace</code> to spy on <code>execve</code>
calls too!</p>
<p>For example! I was trying to understand a Ruby script that was
basically just running some <code>ssh</code> commands. I could have read the Ruby
code! But I really just wanted to know which damn command it was
running! I did this by running <code>strace -f -s3000 -e trace=execve</code> and
read zero code!</p>
<p>The <code>-f</code> option is super important here. It also tracks the system
calls of every subprocess! I basically use <code>-f</code> all the time. Use
<code>-f</code>.
(<a href="http://jvns.ca/secret_blog_test/blog/2014/02/26/using-strace-to-avoid-reading-ruby-code/">[longer blog post about using strace + execve to poke at Ruby programs]</a>).</p>
<h2>write</h2>
<p><code>write</code> writes to files. I think there are ways to write to a file
without using <code>write</code> (like by using <code>mmap</code>), but <em>usually</em> if a file
is being written to, it’s using <code>write</code>.</p>
<p>If I <code>strace -e trace=write</code> on an <code>ssh</code> session, this is some of what
I see:</p>
<pre>write(3, "SSH-2.0-OpenSSH_5.9p1 Debian-5ubuntu1.1\r\n", 41) = 41
[...]
write(5, "[jvns /home/public]$ ", 21)   = 21
write(3, "\242\227e\376\344\36\270\343\331\307\231\332\373\273\324\303X\n&lt;\241p`\212\21\317\353`\1/\3629\273m\23\17\26\304\fJ\352z\210\2\210\211~7W", 48) = 48
write(5, "logout\r\n", 8)               = 8
write(3, "b\277\306\16!\6J\202\tF$\241\32\302\3\0\23\310\346f\241\233\263\254\325\351z\222\234\224\270\231", 32) = 32
write(3, "\311\372\353\273\233oU\226~\373N\227\323*S\263\307\272\204VzO \10\2\316\224\335X@Hj\26\366\271J:i6\311\240A\325\331\341\220\1%\233\240\23n\23\242\34\277\2139\376\31j\255\32h", 64) = 64
write(2, "Connection to ssh.phx.nearlyfreespeech.net closed.\r\n", 52) = 52
</pre>


<p>So it opens an SSH connection, writes a prompt to my terminal, sends
some (encrypted!) data over the connection, and prints that the
connection is closed! Neat! I understand a bit more about how ssh
works now!</p>

<h2>/proc</h2>

<p>I want to talk about one more Linux thing, and it isn’t a system call.
It’s a directory called <code>/proc</code>! There are a million things that
<code>/proc</code> does, but this is my favorite:</p>

<p><code>/proc</code> tells you every file your process has open. All of them! For
example, one of my Chrome processes has PID 3823. If I run <code>ls -l
/proc/3823/fd/*</code>, it shows me all the files Chrome has open!</p>

<p><code>fd</code> stands for “file descriptor”.</p>

<pre>$ ls -l /proc/3823/fd/*
total 0
lr-x------ 1 bork bork 64 Apr 19 09:28 0 -&gt; /dev/null
l-wx------ 1 bork bork 64 Apr 19 09:28 1 -&gt; /dev/null
lrwx------ 1 bork bork 64 Apr 19 09:28 10 -&gt; socket:[16583]
lr-x------ 1 bork bork 64 Apr 19 09:28 100 -&gt; /opt/google/chrome/nacl_irt_x86_64.nexe
lrwx------ 1 bork bork 64 Apr 19 09:28 101 -&gt; /home/bork/.config/google-chrome/Default/Application Cache/Cache/index
lrwx------ 1 bork bork 64 Apr 19 09:28 102 -&gt; /home/bork/.config/google-chrome/Default/Application Cache/Cache/data_0
lrwx------ 1 bork bork 64 Apr 19 09:28 103 -&gt; socket:[178726]
lrwx------ 1 bork bork 64 Apr 19 09:28 104 -&gt; socket:[21064]
lrwx------ 1 bork bork 64 Apr 19 09:28 105 -&gt; /home/bork/.config/google-chrome/Default/Application Cache/Cache/data_1
lrwx------ 1 bork bork 64 Apr 19 09:28 106 -&gt; /home/bork/.config/google-chrome/Default/Application Cache/Cache/data_2
lrwx------ 1 bork bork 64 Apr 19 09:28 107 -&gt; /home/bork/.config/google-chrome/Default/Application Cache/Cache/data_3
</pre>


<p>aaaand a million more. This is great. There are also a ton more things
in <code>/proc/3823</code>. Look around! I wrote a bit more about <code>/proc</code> in
<a href="http://jvns.ca/blog/2014/03/23/recovering-files-using-slash-proc-and-other-useful-facts/">Recovering files using /proc (and spying, too!)</a>.</p>

<h2>ltrace: beyond system calls!</h2>

<p>Lots of things happen outside of the kernel. Like string comparisons!
I don’t need a network card for that! What if we wanted to know about
those? <code>strace</code> won’t help us at all. But <code>ltrace</code> will!</p>

<p>Let’s try running <code>ltrace killall firefox</code>. We see a bunch of things
like this:</p>

<pre>fopen("/proc/10578/stat", "r")                               =&gt; 0x11984f0
free(0x011984d0)
fscanf(0x11984f0, 0x403fe7, 0x7fff09984980, 0x7f2fc7cd4728, 0)
fclose(0x11984f0)
strcmp("firefox", "kworker/u:0")
</pre>


<p>So! We’ve just learned that <code>killall</code> works by opening a file in
<code>/proc</code> (wheeee!), finding what its name is, and seeing if it’s the
same as “firefox”. That makes sense!</p>

<h2>When are these tools useful?</h2>

<p>These systems-level debugging tools are only appropriate sometimes. If
you’re writing a graph traversal algorithm and it has a logical error,
knowing which files it opened won’t help you at all!</p>

<p>Here are some examples of times when using systems tools might make
your life easier:</p>

<ul>
<li>Is your program running a command, but the wrong one? Look at
<code>execve</code>!</li>
<li>Your program communicates with something on a network, but some of
the information it’s sending is wrong? It’s probably sending it with
<code>write</code>, <code>sendto</code>, or <code>send</code>.</li>
<li>Your program writes to a file, but you don’t know what file it’s
writing to? Use <code>/proc</code> to see what files it has open, or look at
what it’s <code>write</code>ing. <code>/proc</code> doesn’t lie.</li>
</ul>


<p>At first debugging this way is confusing, but once you’re familiar
with the tools it can actually be faster, because you don’t have to
worry about getting the wrong information! And you feel like a WIZARD.</p>

<h2>Learn your operating system instead of a new debugger</h2>

<p>There are all kinds of programming-language-specific debugging tools
you can use. <code>gdb</code>! <code>pry</code>! <code>pdb</code>! And you should! But you probably
switch languages more often than you switch OSes. So, learning your OS
in depth and then using it as a debugging tool is likely a better
investment of your time than learning a language-specific debugging
tool.</p>

<p>If you want to know which files a process has open, it doesn’t matter
if that program was originally written in C++ or Python or Java or
Haskell. The <em>only way</em> for a program to open a file on Linux is with
the <code>open</code> system call. If you learn your operating system, you
acquire superpowers. You can debug programs that are binary-only and
closed source. You can use the same tools to debug no matter which
language you’re writing.</p>

<p>And my favorite thing about these methods is that your OS won’t lie to
you. The <strong>only way</strong> to run a program is with the <code>execve</code> system
call. There aren’t other ways. So if you really want to know what
command got run, use <code>strace</code>. See exactly which parameters get passed
to <code>execve</code>. You’ll know exactly what happened.</p>

<h2>Further reading</h2>

<p>Try Greg Price’s excellent blog post
<a href="https://blogs.oracle.com/ksplice/entry/strace_the_sysadmin_s_microscope">Strace – The Sysadmin’s Microscope</a>.
I have an
<a href="http://jvns.ca/secret_blog_test/blog/categories/strace">ever-growing collection of blog posts about strace</a>,
too!</p>

<p>My favorite way to learn more, honestly, is to just strace random
programs and see what I find out. It’s a great way to spend a rainy
Sunday afternoon! =)</p>

<p>Thanks to <a href="http://composition.al/">Lindsey Kuper</a> and
<a href="http://danluu.com/">Dan Luu</a> for reading a draft of this :)</p>

<p>Have fun!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="http://jvns.ca/secret_blog_test/blog/2014/04/13/pycon/">♥ PyCon</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-13T18:37:45-07:00" pubdate="" data-updated="true">Apr 13<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>PyCon 2014 happened! It was my first time at PyCon, I expected to have
a good time, and it was better than I expected. I spoke! People came
up to me and said they enjoyed my talk! There were so many amazing
talks! I met so many people whose work I’d been following! 1/3 of the
talks were by women! It was <em>wonderful</em>.</p>

<p>A few talks that especially stood out to me, or that I missed and
<em>really</em> want to see. I didn’t see anything like all the talks, but I
liked these. In no particular order:</p>

<p><small>
Not all of the videos are up yet, but I’ll come back to this later and
put in video links when they are.
</small></p>

<ul>
<li><a href="https://twitter.com/ctitusbrown">Titus Brown</a> gave a wonderful talk
about his work in computationally intensive biology. I found this
particularly interesting because he offered roughly “I have harder
data problems that your tech job does! Come do a PhD with me and
I’ll pay you a fraction as much.” This was oddly compelling. Very
much worth watching.
<a href="http://ivory.idyll.org/blog/2014-pycon.html">Notes from his talk</a>,
<a href="http://pyvideo.org/video/2697/data-intensive-biology-in-the-cloud-instrumentin">[Video]</a></li>
<li><a href="https://twitter.com/juliepagano">Julie Pagano</a> gave
<a href="https://us.pycon.org/2014/schedule/presentation/164/">advice about battling imposter syndrome</a>.
I liked that her advice was practical! We need better advice than
“you shouldn’t have imposter syndrome!”, and this did well at that.
<a href="http://pyvideo.org/video/2659/its-dangerous-to-go-alone-battling-the-invisibl">[Video]</a></li>
<li><a href="https://twitter.com/jessicamckellar">Jessica McKellar</a>’s keynote on how we can help advance computer
science education was amazing. It was amazing because she gave so
many concrete suggestions and specific calls to action: there were
easy things (for example: call your legislators and tell them CS
should count for AP math/science credit!) and larger commitments.
She challenged everyone to do just one thing in the upcoming year to
try to make CS education in high school better.
<a href="http://pyvideo.org/video/2684/keynote-jessica-mckellar">[Video]</a></li>
<li><a href="https://twitter.com/fperez_org">Fernando Perez</a> spoke about the
state of Python for scientific and how scientists are using IPython
to easily make their work reproducible. I’m so impressed with the
community he’s building around this software. The tools are so good
and getting better so quickly.
<a href="http://pyvideo.org/video/2683/keynote-fernando-perez">[Video]</a></li>
<li><a href="https://twitter.com/NaomiCeder">Naomi Ceder</a> spoke about
<a href="https://us.pycon.org/2014/schedule/presentation/182/">being a trans woman in the Python community</a>.
I saw so many positive comments about her talk on Twitter
afterwards. I’m really interested to see what she has to say, and
delighted that I work in a community where her perspective is
valued.
<a href="http://pyvideo.org/video/2671/farewell-and-welcome-home-python-in-two-genders">[Video]</a></li>
<li><a href="https://twitter.com/paultag">Paul Tagliamonte</a>’s talk about
<a href="https://us.pycon.org/2014/schedule/presentation/192/">compiling Lisp to Python bytecode</a>
was the kind of excited “let’s see how far we can take this crazy
idea!” talk that I really enjoy. Super enjoyable speaker.
<a href="http://pyvideo.org/video/2616/getting-hy-on-python-how-to-implement-a-lisp-fro">[Video]</a></li>
<li><a href="https://twitter.com/hsjuju2">Julie Lavoie</a> talked about
<a href="https://us.pycon.org/2014/schedule/presentation/179/">Analyzing Rap Lyrics with Python</a>.
I liked this because she clearly loves rap, and she gave some
background on rap as an art form, including samples from different
styles. Also it was a super fun introduction to natural language
processing.
<a href="http://pyvideo.org/video/2658/analyzing-rap-lyrics-with-python">[Video]</a></li>
<li><a href="https://twitter.com/tavarm">Tavish Armstrong</a> talked about one of
his favorite topics: how programmers can learn from software
engineering research. His call to action: Try to measure something
about your software engineering practice! Show it to your friends!
Reproduce it! Give a talk at PyCon next year about it!
<a href="http://pyvideo.org/video/2696/software-engineering-research-for-hackers-bridgi">[Video]</a></li>
<li><a href="https://twitter.com/akaptur">Allison Kaptur</a> explained how
<a href="https://us.pycon.org/2014/schedule/presentation/229/">import works in Python, from the ground up</a>.
I loved that she started with a naive version of import and kept
incrementally improving it until we got to a version that resembles
how <code>import</code> actually works.
<a href="http://pyvideo.org/video/2567/import-ant-decisions">[Video]</a></li>
<li>I talked about why IPython Notebook and Pandas are my favorite tools
for exploratory data analysis, and people said they enjoyed how
enthusiastic I was afterwards. Yay!
<a href="http://pyvideo.org/video/2657/diving-into-open-data-with-ipython-notebook-pan-0">[Video]</a>,
<a href="http://bit.ly/pycon-pandas">[Slides]</a>, <a href="https://github.com/jvns/pandas-cookbook">[pandas cookbook]</a></li>
</ul>


<p>A few more talks that I want to watch the videos for, but can’t
comment on because, well, I haven’t yet.</p>

<ul>
<li><a href="http://pyvideo.org/video/2600/for-lack-of-a-better-nameserver-dns-explained">For Lack of a Better Name(server): DNS Explained</a>,
by Lynn Root</li>
<li><a href="http://pyvideo.org/video/2578/cache-me-if-you-can-memcached-caching-patterns">Cache me if you can: memcached, caching patterns and best practices</a>
by Guillaume Ardaud</li>
<li><a href="http://pyvideo.org/video/2568/kneel-and-disconnect-getting-the-fastest-connect">Kneel And Disconnect: Getting The Fastest Connection Out Of A Hostname</a>
by Ashwini Oruganti</li>
<li><a href="http://pyvideo.org/video/2622/an-introduction-to-twisted">An Introduction to Twisted</a> by Stacey Sern</li>
<li><a href="http://pyvideo.org/video/2694/the-python-pipeline-why-you-should-reach-out-to">The Python Pipeline: Why you should reach out to local teachers and how to do it</a> by Selena Deckelmann</li>
<li><a href="http://pyvideo.org/video/2606/realtime-predictive-analytics-using-scikit-learn">Realtime predictive analytics using scikit-learn &amp; RabbitMQ</a> by
Michael Becker</li>
<li><a href="http://pyvideo.org/video/2598/distributed-computing-is-hard-lets-go-shopping">Distributed Computing Is Hard, Lets Go Shopping</a> by Lewis Franklin</li>
<li><a href="http://pyvideo.org/video/2572/fan-in-and-fan-out-the-crucial-components-of-con">Fan-in and Fan-out: The crucial components of concurrency</a> by Brett
Slatkin</li>
<li><a href="http://pyvideo.org/video/2585/building-and-breaking-a-python-sandbox">Building and breaking a Python sandbox</a> by Jessica McKellar (I saw a
version of this at Hacker School and it was amazing)</li>
<li><a href="http://pyvideo.org/video/2695/python-in-the-browser-intro-to-brython">Python in the Browser: Intro to Brython</a> by Susan Tan</li>
<li><a href="http://pyvideo.org/video/2633/garbage-collection-in-python">Garbage Collection in Python</a> by Benjamin Peterson</li>
<li><a href="http://pyvideo.org/video/2640/subprocess-to-ffi-memory-performance-and-why-y">Subprocess to FFI: Memory, Performance, and Why You Shouldn’t Shell Out</a> by Christine Spang</li>
</ul>


<p>I never stop being impressed with people I meet at PyCon. Conferences
are so hard! I want to meet all the people and do all the things and
be in 3 places at things. And the sprints haven’t even happened yet!</p>

<p>I’m so thankful to all the organizers for doing so much work to make
this possible. The conference chair
<a href="https://twitter.com/diana_clarke">Diana Clarke</a> got a standing
ovation at the closing session, and more than deserved it.</p>

<p>♥ PyCon.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="http://jvns.ca/secret_blog_test/blog/page/2/">← Older</a>
    
    <a href="http://jvns.ca/secret_blog_test/blog/archives">Archives</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright © 2014 - Julia Evans -
  <span class="credit">Powered by <a href="http://octopress.org/">Octopress</a></span>
</p>

</footer>
  

<script type="text/rocketscript" data-rocketoptimized="true">
      var disqus_shortname = 'jvns';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/rocketscript" data-rocketoptimized="true">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







<script id="twitter-csp-test"></script></body></html>